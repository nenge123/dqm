var T=Nenge,I=T.I,F=T.F,Module=new class{arguments=["-v","--menu"];preRun=[];postRun=[];noInitialRun=!0;canvas=document.querySelector("#canvas");print=t=>this.log(t);printErr=t=>this.log(t);totalDependencies=0;monitorRunDependencies(t){}async onRuntimeInitialized(t){delete this.wasmBinary;let e=this;e.FS.mkdir("/offline"),await e.DISK.syncfs(e.FS.mount(e.DISK,{},"/offline").mount),await T.FetchItem({url:e.getdatapath("bios_gba.zip"),store:T.LibStore,unpack:!0,success(t){I.toArr(t,(t=>e.DISK.MKFILE(t[0],t[1])))}});let n,a=await this.ROMSTORE.keys({Range:IDBKeyRange.only("gba"),index:"system"}),i=async function(t){let n=e.canvas.getBoundingClientRect(),a=this&&this.textContent?this.textContent.trim():t;e.setCanvasSize(n.width,n.height),e.canvas.hidden=!1,T.$("#status").hidden=!0,document.body.classList.add("active"),e.DISK.MKFILE(a,await e.ROMSTORE.data(a)),e.gameName=a,e.callMain(e.arguments),e.DISK.MKFILE("/offline/recent_games.txt",a+"\n"),e.loadRom=a,e.ccall("se_load_settings")};a.length?(n=T.$append(T.$("#status"),T.$ct("ul",null,"rom-list")),I.toArr(a,(t=>{let a=T.$append(n,T.$ct("li",t,"rom-li"));T.on(T.$append(a,T.$ct("button","run")),"click",(e=>i(t))),T.on(T.$append(a,T.$ct("button","remove")),"click",(n=>{e.ROMSTORE.remove(t),a.remove()}))}))):await T.FetchItem({url:e.getdatapath("dqm_gbc.rar"),unpack:!0,process:t=>T.$("#status").innerHTML=t,success(t){n=T.$append(T.$("#status"),T.$ct("ul",null,"rom-list")),I.toArr(t,(t=>{e.ROMSTORE.put(t[0],{contents:t[1],system:"gba"}),T.on(T.$append(n,T.$ct("li",t[0],"rom-li")),"click",i)}))},catch(t){alert(t)}}),T.on(T.$append(T.$("#status"),T.$ct("button","import",null,{style:"margin:2em"})),"click",(t=>{e.upload((t=>{I.toArr(t,(async t=>{let a=await T.unFile(t);I.u8buf(a)?(e.ROMSTORE.put(t.name,{contents:a,system:"gba"}),T.on(T.$append(n,T.$ct("li",t.name,"rom-li")),"click",i)):I.toArr(a,(t=>{/(gb|gbc|gba)/i.test(t[0])&&t[1].length>1024&&(e.ROMSTORE.put(t[0],{contents:t[1],system:"gba"}),T.on(T.$append(n,T.$ct("li",t[0],"rom-li")),"click",i))}))}))}))}));let s=T.$append(T.$("#status"),T.$ct("ul",null,"rom-list")),o=e.DISK.DB["/offline"];I.toArr(await o.keys(),(t=>{let n=T.$append(s,T.$ct("li",t,"rom-li"));T.on(T.$append(n,T.$ct("button","down","rom-li")),"click",(async e=>{T.down(t,await o.findItem(t,"contents"))})),T.on(T.$append(n,T.$ct("button","replace","rom-li")),"click",(async function(a){e.upload((async e=>{let a=await T.unFile(e[0]),i=await o.findItem(t);this.classList.remove("active"),i&&i.contents?(I.u8buf(a)?(i.contents=a,o.saveItem(i,t)):I.toArr(a,(e=>{F.getExt(t)==F.getExt(e[0])&&(i.contents=a,o.saveItem(i,t))})),n.classList.add("active")):this.classList.add("active")}),!0)})),T.on(T.$append(n,T.$ct("button","delete","rom-li")),"click",(async e=>{await o.removeItem(t),n.remove()}))}))}constructor(){this.init()}log(t){}setStatus(t){}async init(){let t=this;t.ROMSTORE=T.getStore("rom","DQM"),t.DISK=new NengeDisk({"/offline":"offline"},"SkyEmu"),t.DISK.SetModule(t),t.DISK.Filter=t=>/recent_games\.txt/.test(t);let e=await T.FetchItem({url:t.getdatapath("SkyEmu.zip"),store:T.LibStore,unpack:!0,process:t=>T.$("#status").innerHTML=t});t.wasmBinary=e["SkyEmu.wasm"];let n=I.decode(e["SkyEmu.js"])+await T.FetchItem({url:T.JSpath+"SkyEmu_fix.js",type:"text"});delete e["SkyEmu.js"],e=null,new Function("Module",n)(t)}upload(t,e){let n=T.$ce("input");n.type="file",e||(n.multiple=!0),n.onchange=e=>{let a=e.target.files;if(a&&a.length>0)return t(a);n.remove()},n.click()}getdatapath(t){return"./../assets/data/"+t}};"serviceWorker"in navigator&&navigator.serviceWorker.register("../sw.js").then((t=>{t.active.postMessage("register ok")})).catch((t=>{}));