const Nenge=new class{version=1;DB_NAME="DQM";DB_STORE_MAP={libjs:{},rom:{system:!1}};LibStore="libjs";maxsize=104857600;part="-part-";lang={};action={};StoreTable={};isLocal=/^(127|localhost|172)/.test(location.host);constructor(){let e=this,t=e.I;window.matchMedia&&!window.matchMedia("(prefers-color-scheme: light)").matches&&t.setStyle(document.documentElement,{"color-scheme":"dark"}),e.language=t.language,e.i18nName=t.i18n,t.mobile&&e.on(window,"error",(e=>alert(e.message||e)));let r=document.currentScript&&document.currentScript.src.split("?");e.JSpath=r&&r[0].split("/").slice(0,-1).join("/")+"/",e.triger(document,"NengeStart",{detail:e}),e.RunJs(r&&t.Attr(document.currentScript,"query"))}async RunJs(e){let t=this,r=t.I;if(e){let a=r.FormGet(e);t.SP(a.get("js")||"",(e=>e&&t.addJS(this.F.getpath(e.replace("?rand","?"+t.time))))),t.version=a.get("version")||t.version}t.docload((e=>t.triger(document,"NengeReady",{detail:t})))}get date(){return new Date}get time(){return this.date.getTime()}get rand(){return Math.random()}get randNum(){return this.I.IntVal(this.rand.toString().slice(2))}dbName(e){return e||this.DB_NAME}async getItem(e,t,r,a){if((a=a||{}).dbName=this.dbName(a.dbName),a.store=e,!t)return await this.getAllData(e,1,a);let s=this,n=s.F,i=s.I,l=await n.dbGetItem(t,a);if(i.obj(l)){let e=s.maxsize,o=s.part,u=t.split(o)[0],c=l.version,d=l.filesize/e,p=l.type;r&&c&&c!=r?l=void 0:d>1&&(l.contents=i.R(14,(await n.dbGetItem(i.toArr(d).map((e=>{let r=u;if(e>0&&(r+=o+e),r!=t)return r})),a)).map((e=>e?e.contents:l.contents)),l.filename||u,{type:l.filetype||n.getMime(l.filename||u)}));let m=l.contents;!m||i.str(m)||i.obj(m)||("unpack"==p?m=await n.unFile(m,{password:a.password||l.password,process:a.process}):["String","Json"].includes(p)?(m=i.blob(m)?await m.text():i.decode(m),("Json"==p||/json/.test(l.filetype))&&(m=i.Json(m))):"File"!=p&&i.blob(m)&&(m=i.U8(await m.arrayBuffer())),l.contents=m)}return l}async setItem(e,t,r,a){let s=this,n=s.F,i=s.I,l=s.maxsize,o=s.part,u={store:e,dbName:s.dbName(a)};if(i.obj(r)&&r.contents){let e=r.contents;if(e=await n.dbU8(e,l),i.u8buf(e)&&e.byteLength>l){let a=e.byteLength;r.filesize=a,r.contents=null,delete r.contents,r=i.toObj(i.toArr(r).filter((e=>!i.none(e[1]))));let s=await n.dbPutArr(i.toArr(a/l).map((s=>{let n=s*l;return{data:i.assign({contents:i.U8(e.subarray(n,a-n>=l?n+l:a))},r),name:s>0?t+o+s:t}})),u);return e=null,s}r.contents=e}else if(r&&(r=await n.dbU8(r,l),i.u8buf(r)&&r.byteLength>l))return s.setItem(e,t,{contents:r,timestamp:s.date},a);return await n.dbPutItem(r,t,u)}async removeItem(e,t,r){let a=this,s=a.I,n=a.F;if((r=r||{}).dbName=a.dbName(r.dbName),r.store=e,r.filesize&&(r.clear=!0),r.clear){if(!r.filesize){let e=await n.dbGetItem(t,r);r.filesize=e&&e.filesize,a.null(e)}if(r.filesize){let e=t.split(a.part)[0];return await n.dbRemoveItem(s.toArr(r.filesize/a.maxsize).map((t=>{let r=e;return t>0&&(r+=a.part+t),r})),r)}}return await n.dbRemoveItem(t,r)}async getAllData(e,t,r){if(!e)return{};let a=this;return r=r||{},await a.F.dbGetAll(a.I.assign(r,{store:e,only:t,dbName:a.dbName(r.dbName)}))}async getContent(e,t,r,a){(a=a||{}).dbName=this.dbName(a.dbName);let s=await this.getItem(e,t,r,a);return s&&s.contents||s}async setContent(e,t,r,a){let s=this;return a=a||{},await s.setItem(e,t,s.I.assign({contents:r,timestamp:s.date},a.options),s.dbName(a.dbName))}async getAllKeys(e,t){let r=this;return t=t||{},await r.F.dbGetKeys(r.I.assign(t,{store:e,dbName:r.dbName(t.dbName)}))}async getAllCursor(e,t,r,a){let s=this;return a=a||{},await s.F.dbGetCursor(s.I.assign(a,{store:e,only:r,index:t,dbName:s.dbName(a.dbName)}))}async clearTable(e,t){if(!e)return;let r=this.F;return await r.dbClearTable(e,this.dbName(t))}async removeTable(e,t){let r=this.F;return await r.deleteDatabase(e,this.dbName(t))}getStore(e,t,r){if(!e)return;let a=this;return e instanceof a.DataStore?e:(t=a.dbName(t),a.StoreTable[t]||(a.StoreTable[t]={}),a.StoreTable[t][e]||(a.StoreTable[t][e]=new a.DataStore(e,t,r)),a.StoreTable[t][e])}async FetchItem(e){let t=this,r=t.F,a=t.I;e&&!a.str(e)||(e={url:e||"/"});let s,n,i,l="arrayBuffer",o=r.getname(e.url),u=e.key||o||"index.php",c=u==r.LibKey?u+o:u,d=e.version,p={},m=e.decode,h=m&&(a.str(m)?e=>a.decode(e,m):!0===m?a.decode:m),b=e.store&&t.getStore(e.store,e.dbName,e.index,e.dbOpt),g=(t,s)=>r.unFile(t,a.assign(e,{password:s})),y=async r=>(r&&r.contents&&("unpack"==r.type?(r=await g(r.contents,r.password)).password&&delete r.password:r=r.contents),f(r),t.null(e),e=null,r),f=t=>t&&e.success&&e.success(t,p);if(delete e.store,e.filename||(e.filename=o),e.onLine&&(e.unset=navigator.onLine),b&&(s=await b.get(c,d,e),s&&!e.unset&&!e.checksize))return y(s);if(n=await r.FetchStart(e).catch((t=>e.error&&e.error(t.message))),!n)return y(s);p=r.FetchHeader(n,e),a.exends(p,n,["url","status","statusText"]),e.filename&&(p.filename=e.filename);let w=p.password||e.password||void 0;if(200!=n.status)return n.body&&(n.body.cancel(),e.error&&e.error(n.statusText,p)),"head"==e.type&&f(p),y(s);if(s&&s.filesize&&p.byteLength>0){if(s.filesize==p.byteLength)return n.body.cancel(),y(s);t.null(s),s=null}else if("head"==e.type)return n.body.cancel(),y(p);let v=a.func(e.process)?await r.StreamResponse(n,e.process,p):n;e.unpack&&(e.type=l),e.type=e.type||l,i=await v[e.type]();let I=p.type,F=p.byteLength||0,A=p["content-type"];if(e.type==l&&a.buf(i)&&(i=a.U8(i),I=a.N(11)),e.Filter&&(i=await e.Filter(i)),F=i.byteLength||i.length,e.autounpack&&F<.3*t.maxsize&&(e.unpack=!0),e.dataOption=e.dataOption||{},b&&e.unpack&&u===c&&F>t.maxsize&&(I="unpack",await b.put(c,a.assign({contents:i,timestamp:new Date,filesize:F,filetype:A,version:d,type:I,password:w},e.dataOption)),b=null),e.unpack&&a.u8buf(i)&&(i=await g(i,w),i.byteLength||(i.password&&(w=i.password,delete i.password),I="datalist")),b&&u!==c){if(a.u8buf(i))i=r.getFileText(i,h,e.mime||p["content-type"]||r.getMime(""),o),I=a.blob(i)?"File":"String";else if(a.str(i))I=p["content-type"]||"String";else if("datalist"==I){let s;await a.Async(a.toArr(i).map((async n=>{let[i,l]=n,o=r.getname(i),c=r.getMime(o),d=r.getFileText(l,h,c,o);return await b.put(u+o,a.assign({contents:d,timestamp:t.date,filesize:l.byteLength,filetype:c,version:t.version,type:a.blob(d)?"File":"String"},e.dataOption)),e.filename==o&&(s=d),!0}))),s&&(i=s),s=null,b=null}}else h&&(i=r.getFileText(i,h,I),a.str(i)&&(I="String"));return b&&await b.put(c,a.assign({contents:i,timestamp:t.date,filesize:F,filetype:A,version:d,type:I,password:w},e.dataOption)),y(i)}ajax(e){let t=this,r=t.I;return r.str(e)&&(e={url:e}),r.Async((a=>{const s=new XMLHttpRequest(e.paramsDictionary);let n=["progress","readystatechange","error","abort","load","loadend","loadstart","timeout"];t.on(s,n[2],(t=>{e.error&&e.error("net::ERR_FAILED"),a(null)})),t.on(s,n[1],(t=>{let n;switch(s.readyState){case s.LOADING:case s.OPENED:case s.UNSENT:break;case s.HEADERS_RECEIVED:if(n=r.toObj((s.getAllResponseHeaders()||"").trim().split(/[\r\n]+/).map((e=>{let t=e.split(": ");return[t.shift(),t.join(": ")]})).concat([["status",s.status],["statusText",s.statusText],["url",e.url]])),"head"==e.type)return s.abort(),e.success&&e.success(n,s),void a(n);break;case s.DONE:200==s.status?(e.success&&e.success(s.response,n,s),a(s.response)):(e.error&&e.error(s.statusText,n,s),a(null));break}})),e.process&&t.on(s,n[0],(t=>e.process(r.PER(t.loaded,t.total),t.total,t.loaded,0,s))),e.postProcess&&t.on(s.upload,n[0],(t=>e.postProcess(r.PER(t.loaded,t.total),t.total,t.loaded,t))),r.toArr(n,(a=>r.none(e[a])||(t.on(s,val,e[a]),r.DP(e,a)))),e.upload&&r.toArr(n,(a=>r.none(e.upload[a])||(t.on(s,val,e.upload[a]),r.DP(e.upload,a))));let i,l=e.type||"",o=e.headers||{},u=e.noajax?{}:{inajax:t.time};e.overType&&s.overrideMimeType(e.overType),e.json?(i=r.toJson(e.json),l||(l="json"),r.assign(o,{Accept:"application/json, text/plain, */*"})):e.post&&(i=r.post(e.post)),"head"!=l&&(s.responseType=l),s.open(i?"POST":"GET",r.get(e.url,u,e.get)),r.toArr(o,(e=>s.setRequestHeader(e[0],e[1]))),s.send(i)}))}Set(e,t){const r=this;return t||(t=r.I),e.action||(e.action={}),t.defines(e,{I:t,T:r,RF:r.RF,CF:r.CF,BF:r.BF},1),t}RF(e,t){const r=this,a=r.action,s=r.I;if(a[e])return s.func(a[e])?s.Apply(a[e],r,t||[]):a[e]}CF(e,...t){return this.RF(e,t)}BF(e){const t=this,r=t.action,a=t.I;if(r[e])return a.func(r[e])?r[e].bind(t):r[e]}addJS(e,t,r,a){let s=this,n=s.F,i=s.I;if(i.blob(e)&&(a=n.getKeyName(e.name),/css/i.test(e.type)&&(r=!0)),a&&s.$("#link_"+a))return;let l=s.$ce(r?"link":"script"),o=t=>{e=n.URL(e,r?"css":"js"),r?(l.type=n.getMime("css"),l.href=e,l.rel="stylesheet"):(l.type=n.getMime("js"),l.src=e),a&&i.Attr(l,{id:"link_"+a}),l.onload=a=>{t&&t(a),r||(l.remove(),/^blob:/.test(e)&&n.removeURL(e)),e=null},s.$append(document[r?"head":"body"],l)};return t?(o(t),l):i.Async(o)}async loadScript(e,t,r){t=t||{};let a=this,s=a.F;t.url=s.getpath(e),r?t.type="text":(t.store||(t.store=a.LibStore),t.key||(t.key=s.LibKey)),t.version=t.version||a.version;let n=await a.FetchItem(t);return r?n:await a.addJS(n)}async getScript(e,t){return this.loadScript(e,t,!0)}async addScript(e,t){return await T.addJS(await T.getScript(e,t),null,"css"==F.getExt(e))}async loadLibjs(e,t,r,a,s){let n=this.F;return await this.addJS(await n.getLibjs(e,t,r,a,s),null,"css"==n.getExt(e))}unFile(e,t,r){return this.F.unFile(e,this.I.assign({process:t},r||{}))}on(e,t,r,a,s){let n=this,i=n.I;return e=n.$(e),n.SP(t,(t=>i.on(e,t,r,!1===a?{passive:!1}:a,s))),e}un(e,t,r,a,s){let n=this,i=n.I;return e=n.$(e),n.SP(t,(t=>i.un(e,t,r,!1===a?{passive:!1}:a,s))),e}spilt(e,t,r){let a=this.I,s=r||",";return a.toArr(a.str(e)?e.replace(/[\s\|,]+/g,s).split(s).filter((e=>!a.empty(e))):e,t)}SP(e,t,r){let a=this.I,s=r||",";return a.toArr(a.str(e)?e.replace(/[\s\|,]+/g,s).split(s).filter((e=>!a.empty(e))):e,t)}once(e,t,r,a){return this.on(e,t,r,{passive:!1,once:!0},a)}docload(e){let t=this,r=document;return"complete"==r.readyState?e&&e.call(t):t.I.Async((a=>{let s=()=>{e&&e.call(t),a(t)};"loading"==r.readyState?t.once(r,"DOMContentLoaded",s):s()}))}$(e,t){let r=this.I;return e?r.str(e)?r.$(e,t):r.func(e)?this.docload(e):e:void 0}$$(e,t){return this.I.$$(e,t)}$ce(e){return this.I.$c(e)}$ct(e,t,r,a){let s=this.I,n=this.$ce(e);return t&&(n.innerHTML=s.str(t)?t:t()),!a||s.Attr(n,a),!r||s.Attr(n,"class",r),n}$append(e,t){return this.I.str(t)&&(t=this.$ce(t)),e.appendChild(t),t}$add(e,t){return e.classList.add(t),e}customElement(e){let t=this;window.customElements.define(e,class extends HTMLElement{elmName=this.tagName.replace(/-/g,"_");constructor(){super(),t.CF("TAG_"+this.elmName+"_INIT",this,"init")}connectedCallback(){t.CF("TAG_"+this.elmName,this,"connect")}attributeChangedCallback(e,r,a){t.CF("TAG_"+this.elmName+"_ATTR",this,"attribute",{name:e,oldValue:r,newValue:a})}disconnectedCallback(){t.CF("TAG_"+this.elmName+"_REMOVE",this,"disconnect")}})}docElm(e,t){return(new DOMParser).parseFromString(e,t||"text/html")}HTMLToTxt(e,t){let r=this.I;return r.str(e)&&(e=this.docElm(e)),r.doc(e)?e.body[t?"innerHTML":"textContent"]:""}fragment(){return new DocumentFragment}Err(e){return new Error(e)}down(e,t,r){return this.F.download(e,t,r)}getLang(e,t){return this.GL(e,t)}GL(e,t){let r=this,a=r.I;return a.none(r.lang[e])||(e=r.lang[e]),a.obj(t)?a.RegRe(e,t):e}triger(e,t,r){let a=this,s=a.I;return e=a.$(e),r||(r={detail:e}),s.evt(t)?a.dispatch(e,t):a.dispatch(e,new s.O[22](t,r)),e}dispatch(e,t){return e.dispatchEvent(t),e}stopGesture(e){this.setStyle(e,{"touch-action":"none"})}stopEvent(e){e.preventDefault()}stopProp(e,t){t||e.preventDefault(),e.stopPropagation()}null(e){if(this.I.obj(e))for(var t in e)e[t]=null,delete e[t]}I=new class{O=[Array,Object,Element,HTMLFormElement,FormData,URLSearchParams,NamedNodeMap,DOMStringMap,CSSStyleDeclaration,Document,ArrayBuffer,Uint8Array,Promise,Blob,File,String,DOMRect,Event,KeyboardEvent,Function,Boolean,Headers,CustomEvent,HTMLCollection,FileList,TextDecoder,TextEncoder,NodeList,Number,RegExp];constructor(e){let t=this,r=t.O;t.defines(this,{IF:{value:(e,t)=>e instanceof r[t]},elm:{value:e=>t.IF(e,2)},elmform:{value:e=>t.IF(e,3)},urlpost:{value:e=>t.IF(e,4)},urlget:{value:e=>t.IF(e,5)},nodemap:{value:e=>t.IF(e,6)},DOMmap:{value:e=>t.IF(e,7)},elmCss:{value:e=>t.IF(e,8)},await:{value:e=>t.IF(e,12)},blob:{value:e=>t.IF(e,13)},file:{value:e=>t.IF(e,14)},evt:{value:e=>t.IF(e,17)},keyevt:{value:e=>t.IF(e,18)},func:{value:e=>t.IF(e,19)},header:{value:e=>t.IF(e,21)},nodelist:{value:e=>t.IF(e,27)},IC:{value:(e,a)=>t.C(e)===r[a]},array:{value:e=>t.IC(e,0)},obj:{value:e=>t.IC(e,1)},doc:{value:e=>t.IC(e,9)},buf:{value:e=>t.IC(e,10)},u8obj:{value:e=>t.IC(e,11)},u8buf:{value:e=>t.IC(e,11)},str:{value:e=>t.IC(e,15)},bool:{value:e=>t.IC(e,20)},num:{value:e=>t.IC(e,28)},null:{value:e=>null===e},none:{value:e=>void 0===e},R:{value:(e,...t)=>Reflect.construct(this.O[e],t)},H:{value:e=>a[0]&&e.hasOwnProperty(a[0])||!1},DP:{value:(e,...t)=>Reflect.deleteProperty(e,t[0])},Arr:{value:e=>new r[0](e)},ArrFrom:{value:e=>r[0].from(e)},FromEntries:{value:e=>r[1].fromEntries(e)},Keys:{value:e=>r[1].keys(e)},U8:{value:e=>t.u8buf(e)?e:new r[11](e.buffer||e)},buf16str:{value:e=>t.toArr(e).map((e=>e.toString(16).padStart(2,0).toLocaleUpperCase())).join("")},ArrTest:{value:(e,...r)=>t.toArr(e).filter((e=>e[1].test(r[0])))[0]},decode:{value:(e,...t)=>new r[25](t[0]).decode(e)},encode:{value:e=>(new r[26]).encode(e)},FormPost:{value:e=>new r[4](e)},FormGet:{value:e=>new r[5](e)},Int:{value:e=>new r[28](e)},IntVal:{value:(e,...t)=>parseInt(e,t[0])},IntSize:{value(e){e=this.Int(e)}},PER:{value:(e,...r)=>t.Int(100*e/r[0]).toFixed(0)+"%"},Async:{value(e,...t){return e?this.array(e)?Promise.all(e):new Promise(e,t[0]):null}},$:{value:(e,...t)=>(t[0]||document).querySelector(e)},$$:{value:(e,...t)=>(t[0]||document).querySelectorAll(e)},$c:{value:(e,...t)=>document.createElement(e)},RegRe:{value:(e,...a)=>(t.toArr(a[0],(t=>e=e.replace(new r[29]("{"+t[0]+"}","g"),t[1]))),e)},elmdata:{value:e=>t.toObj(e.dataset||e||{})||{}},setStyle:{value:(e,...r)=>(t.toArr(r[0],(r=>(e.style||e)[(t.bool(r[1])&&!r[1]?"remove":"set")+"Property"](r[0],r[1]))),e)},Attr:{value:(e,...r)=>t.obj(r[0])?t.toArr(r[0],(r=>t.Attr(e,r[0],r[1]))):r[0]?e[(r[1]?"set":"get")+"Attribute"](r[0],r[1]):t.toObj(e.attributes)},Call:{value:(e,...t)=>Reflect.apply(e,t.shift(),t)},Apply:{value:(e,...r)=>(t.str(e)&&(e=r[0][e]),Reflect.apply(e,r[0],r[1]))},on:{value(e,...r){e&&t.Apply(addEventListener,e,r)}},un:{value(e,...r){e&&t.Apply(removeEventListener,e,r)}},GP:{value:(e,t)=>e.getPropertyValue(t)},EQ:{value(e){let t=[],r=e.next();for(;!r.done;)t.push(r.value),r=e.next();return t}},ET:{value(e){let r=[];for(let a=0;a<e.length;a++){let s=e.item(a);"string"==typeof s&&e.getPropertyValue?r.push([s,t.GP(e,s)]):s.value?r.push([s.name,s.value]):r.push(s)}return r}},FE:{value(e){let t=[];return e.forEach(((e,r)=>t.push([r,e]))),t}},getEntries:{value:e=>e.item?t.ET(e):e.byteLength?t.ArrFrom(new r[11](e.buffer||e)):e.entries?t.EQ(e.entries()):e.length?t.ArrFrom(e):e.forEach?t.FE(e):t.Entries(e)}})}N(e){return isNaN(e)?this.X(e):this.O[e].name}C(e){return null!=e&&null!=e&&e.constructor}X(e){return this.C(e)&&this.C(e).name||""}F(e,t){return t&&e.forEach&&e.forEach(t),e}assign(...e){let t=this;return t.Apply(t.O[1].assign,{},t.array(e[0])?e[0]:e)}exends(e,t,r){return r?this.toArr(r,(r=>e[r]=t[r])):e=this.assign(e,t),e}get mobile(){return"ontouchend"in document}get language(){return navigator.language}get i18n(){let e=this.language.split("-");return e="zh"==e[0]?"CN"==e[1]?"zh-hans":"zh-hant":e[0],e}post(e){let t=this,r=t.urlpost(e)?e:t.FormPost(t.elmform(e)?e:t.str(e)?t.$(e):void 0);return t.obj(e)&&t.toArr(e,(e=>r.append(e[0],e[1]))),r}get(e,...t){let r=this,a=e.split("?"),s=a[1]&&a[1].split("#")[0]||"",n=r.toArr(t).map((e=>e?r.FormGet(e):"")).join("&"),i=r.FormGet(s+"&"+n).toString().replace(/=&/g,"&");return a[0]+(i?"?"+i:"")}toObj(e){if(!e)return{};let t=this;return t.obj(e)?e:e=t.array(e)?t.FromEntries(e):t.FromEntries(t.getEntries(e))}Entries(e,t){return this.F(this.O[1].entries(e),t)}toArr(e,t){if(!e)return[];let r=[],a=this,s=a.C(e);return r=s==a.O[0]?e:a.obj(e)?a.Entries(e):s==a.O[28]?Array.from("".padStart(e)):s!=a.O[0]?a.getEntries(e):e,a.func(t)?a.F(r,t):r}define(e,t,r,a,s){return this.O[1].defineProperty(e,t,a?{get:()=>r,configurable:!!s}:r),e}defines(e,t,r,a){return r?this.toArr(t,(t=>this.define(e,t[0],t[1],1,a))):this.O[1].defineProperties(e,t),e}Json(e){let t=this,r=t.O;return t.u8buf(e)&&(e=t.decode(e)),"string"==typeof e?new r[19]("return "+e)():e}toJson(e){return JSON.stringify(this.Json(e))}empty(e){return!e||(this.str(e)?0==e.trim().length:this.array(e)?0==e.length:!!this.obj(e)&&0==this.toArr(e).length)}}(this);F=new class{Libjs={};LibKey="script-";zipsrc="zip.min.js";extutf16={"7z":/^377ABCAF271C/,rar:/^52617221/,zip:/^504B0304/,png:/^89504E470D0A1A0A/,gif:/^47494638/,jpg:/^FFD8FF/,webp:/^52494646/,pdf:/^255044462D312E/};exttype={"application/octet-stream":["*"],"application/javascript":["js"],"text/css":["css","style"],"text/scss":["scss"],"text/sass":["sass"],"text/html":["html","htm","php"],"text/plain":["txt"],"text/xml":["xml","vml"],image:["jpg","jpeg","png","gif","webp"],font:["woff","woff2","ttf","otf"],"image/svg+xml":["svg"],application:["pdf","json"],"application/x-zip-compressed":["zip"],"application/x-rar-compressed":["rar"],"application/x-7z-compressed":["7z"]};action={textext(e){let t=this.I,r=t.buf16str(e),a=t.ArrTest(this.extutf16,r);return a&&a[0]?a[0]:""},async rar(e,t,r){let a,s=this,n=s.I;n.blob(e)&&(!t.filename&&e.name&&(t.filename=e.name),e=n.U8(await e.arrayBuffer())),r=r||"libunrar.min.zip";let i,l=await s.getLibjs(r,a);return t.process&&(i=t.filename?s.T.getLang("Decompress:")+t.filename+" --":s.T.getLang("Decompress:"),a=e=>t.process(i+(e.file?s.getname(e.file):"")+" "+n.PER(e.current,e.total),e.total,e.current)),n.Async((r=>{let n,i=new Worker(l);i.onmessage=l=>{let o=l.data,u=o.t;if(1===u)r(n||e),l.target.terminate();else if(2===u)n||(n={}),n[o.file]=o.data;else if(4===u&&o.total>0&&o.total>=o.current)a&&a(o);else if(-1==u){let a=prompt(s.T.getLang(o.message),t.password||"");if(!a)return r(e),l.target.terminate();t.unpack&&(n.password=a),t.password=a,i.postMessage({password:a})}},i.onerror=async t=>{r(e),i.terminate()},i.postMessage({contents:e,password:t.password})}))},"7z":function(e,t){return this.CF("rar",e,t,"extract7z.zip")},async zip(e,t={}){return this.T.Libzip==this.zipsrc?this.CF("zipjs",e,t):this.CF("rar",e,t,this.T.Libzip)},async zipjs(e,t){t=t||{};let r=this.T;window.zip||await r.loadLibjs(r.JSpath+this.zipsrc);var a=new zip.ZipReader(new(zip[r.I.u8buf(e)?"Uint8ArrayReader":"BlobReader"])(e)),s={},n=void 0,i=async e=>{s[e.filename]=await e.getData(new zip.Uint8ArrayWriter,{onprogress:(a,s)=>t.process&&t.process(e.filename+" "+r.I.PER(a,s)),password:n})},l=async e=>{try{null==n&&(n=t.password),await i(e)}catch(t){n=window.prompt(r.getLang("Invalid password"),n),await l(e)}},o=await a.getEntries(),u=0;if(o)for(;o[u];){let e=o[u];u++,e.directory||(e.encrypted&&!n?await l(e):await i(e))}return s}};async StreamResponse(e,t,r){let a=this.I,s=r["content-length"]||0,n=this.T.getLang("process:"),i=0,l={done:!1,value:!1},o=await e.body.getReader();return new Response(new ReadableStream({async start(e){for(;!l.done;){let u=0,c="";l.value&&(u=l.value.length,i+=u,e.enqueue(l.value)),c=s&&i<s?n+a.PER(i,s):n+(i/1024).toFixed(1)+"KB",t((r.filename?r.filename+" ":"")+c,s,i,u),l=await o.read()}e.close()}}))}FetchHeader(e,t){let r=this.I,a=r.toObj(e.headers)||{};return r.F((a["content-type"]||this.getMime(t.url||"html")).split(";"),((e,t)=>{if(e=e.trim().toLowerCase(),0==t)a["content-type"]=e.trim();else if(-1!=e.search(/=/)){let t=e.split("=");a[t[0].trim()]=t[1].trim()}})),r.assign(a,{byteLength:r.IntVal(a["content-length"])||0,password:a.password||a["content-password"],type:a.type||a["content-type"].split("/")[1].split("+")[0]})}async FetchStart(e){let t,r=this.I,a={headers:{}};return r.toArr(["headers","context","referrer","referrerPolicy","mode","credentials","redirect","integrity","cache"],(t=>r.none(e[t])||(a[t]=e[t],r.DP(e,t)))),e.json?(t=r.toJson(e.json),a.headers.Accept="application/json"):e.post&&(t=r.post(e.post)),t&&(a.method="POST",a.body=t),r.toArr(["get","post","json"],(t=>r.DP(e,t))),fetch(r.get(e.url,e.get),a)}CheckExt(e){let t=this.I,r=e.slice(0,16),a=this.BF("textext"),s=t.blob(r)?r.arrayBuffer():t.str(r)?t.encode(r):r;return t.await(s)?t.Async((async e=>{e(a(await s))})):a(s)}async unFile(e,t={}){let r=this,a=r.I;a.await(e)&&(e=await e),a.array(e)&&(e=a.U8(e));let s=a.file(e)&&/(zip|rar|7z)/i.test(r.getExt(e.name))&&r.getExt(e.name)||await r.CheckExt(e);return!r.action[s]||t.PassExt&&t.PassExt.includes(zip)?(a.blob(e)&&(e=a.U8(await e.arrayBuffer())),e):await r.CF(s,e,t)}async getLibjs(e,t,r,a,s){let n=this,i=n.T,l=n.I,o=n.getname(e),u=o.replace(/\.zip$/,".js");if(n.Libjs[o])return n.Libjs[o];if(n.Libjs[u])return n.Libjs[u];r=r||i.version;let c=await i.getStore(i.LibStore).data(n.LibKey+u,r);return c||(/\.zip$/.test(o)&&await n.getLibjs(i.Libzip,t),c=await i.FetchItem({url:n.getpath(e),store:i.LibStore,key:n.LibKey,unpack:!0,filename:u,version:r,process:t,Filter:s,decode:a})),/json$/.test(u)?n.Libjs[u]=c:c&&(l.obj(c)?n.I.toArr(c,(e=>n.Libjs[e[0]]=e[1]&&n.URL(e[1],e[0]))):n.Libjs[u]=n.URL(c,u)),c=null,n.Libjs[u]}getname(e){return(e||"").split("/").pop().split("?")[0].split("#")[0]}getpath(e){return/^(\/|https?:\/\/|static\/js\/|data\/|assets|blob\:|\.|\/)/.test(e)?e:this.T.JSpath+e}getFileText(e,t,r,a){let s=this,n=s.I;return/json$/.test(r)&&n.u8buf(e)?n.Json(e):a&&r&&!t?n.R(14,[e],a,{type:r}):t?n.u8buf(e)?t(e):(n.obj(e)&&n.toArr(e,(r=>{/(text|javascript|xml|json)/.test(s.getMime(r[0]))&&n.u8buf(r[1])&&("json"==s.getExt(r[0])?e[r[0]]=n.Json(r[1]):e[r[0]]=t(r[1]))})),e):e}getExt(e){return this.getname(e).split(".").pop().toLowerCase()}getKeyName(e){let t=this.getname(e).split(".");return t.pop(),t.join(".")}getMime(e,t){let r,a=this,s=a.I;return a.exttype[e]?r=e:(a.extlist||(a.extlist=s.assign(s.toArr(a.exttype).map((e=>s.toObj(s.toArr(e[1]).map((t=>{let r=e[0];return/\//.test(r)?/text\/xml/.test(r)&&"xml"!=t&&(r+="+"+t):(delete a.exttype[r],r+="/"+t),r!=e[0]&&(a.exttype[r]=[t]),[t,r]}))))))),r=a.extlist[a.getExt(e)]||a.extlist["*"]),t&&/(text|javascript|xml|json)/.test(r)?r+";chartset=utf8":r}URL(e,t){let r=this.I;return r.str(e)&&/^(blob|http|\/|\w+\/|\.+\/)[^\n]*$/i.test(e)?e:window.URL.createObjectURL(r.blob(e)?e:new Blob([e],{type:this.getMime(t||"js")}))}removeURL(e){return window.URL.revokeObjectURL(e)}download(e,t,r){let a,s=this;s.I.str(e)?/^(http|blob:)/.test(e)?(a=e,e="n.js"):t&&(a=s.URL(t,r)):(a=s.URL(e,r),e=e.name||"n.js");let n=document.createElement("a");n.href=a,n.download=e,n.click(),n.remove()}get idb(){return window.indexedDB||window.webkitindexedDB}dbConf={};DataBase={};dbSetConf(e,t,r,a){let s=this,n=s.I,i=s.T,l=s.dbConf,o=s.dbname;return l[s.dbname]||(l=n.assign(l,n.toObj([[o,i.DB_STORE_MAP]]))),e&&(l[t]||(l[t]={}),l[t][e]||(l[t][e]=a||r&&n.toObj([[r,!1]])||{})),l!=s.dbConf&&(s.dbConf=l),l}async dbLoad(e,t,r){let a=this,s=a.I,n=a.dbSetConf(e,t,r)[t],i=a.DataBase[t];if(i&&(s.await(i)&&(i=await i),i.objectStoreNames.contains(e)))return i;if(i||(a.DataBase[t]=a.dbOpen(t,n,undefined),i=await a.DataBase[t]),!a.dbCheckTable(i,n).length)return i;throw"indexDB error"}async dbOpen(e,t,r,a){let s=this,n=s.T,i=n.I;if(s.dbVer||(s.dbVer=i.toObj((await s.idb.databases()).map((e=>[e.name,e.version])))),a&&!t){if(!s.dbVer[e])return;r||(s.DataBase[e]&&(await s.DataBase[e]).close(),delete s.DataBase[e],r=s.dbVer[e]+1)}return i.Async(((l,o)=>{let u=s.idb.open(e,r);n.once(u,"error",(async e=>{o(e)})),n.once(u,"upgradeneeded",a||(async e=>{let r=e.target.result;s.dbCheckTable(r,t,(e=>{let t=r.createObjectStore(e[0]);i.toArr(e[1],(e=>t.createIndex(e[0],e[1]&&e[1].key||e[0],e[1]&&e[1].options||e[1]||{unique:!1})))}))})),n.once(u,"success",(async r=>{let n=r.target.result;if(s.dbVer[e]=n.version,i.toArr(n.objectStoreNames,(t=>s.dbConf[e][t]=s.dbConf[e][t]||{})),a)return l(!0);s.dbCheckTable(n,t).length?(n.close(),s.dbOpen(e,t,n.version+1).then((e=>l(e)))):l(n)}))}))}dbCheckTable(e,t,r){return e?this.I.toArr(t).filter((t=>{if(!e.objectStoreNames.contains(t[0]))return r&&r(t)||!0})):[]}async dbU8(e,t){let r=this.I;return r.await(e)&&(e=await e),r.str(e)&&4*e.lenth>t?e=r.encode(e):r.blob(e)&&e.size>t?e=r.U8(await e.arrayBuffer()):e.buffer&&(e=r.U8(e)),e}async dbSelect(e,t){let r=this,a=r.T;r.I.str(e)&&(e={store:e}),e.store instanceof a.DataStore&&(e.store=e.store.table);let s=e.store;t=t?"readonly":"readwrite";let n=(await r.dbLoad(s,e.dbName,e.index)).transaction([s],t);return n.onerror=e=>{throw e.preventDefault(),n.error},n.objectStore(s)}async dbGetItem(e,t){let r=this.I,a=await this.dbSelect(t,!0);return r.array(e)?r.Async(e.map((e=>e&&r.Async((t=>a.get(e).onsuccess=e=>t(e.target.result)))))):r.Async((t=>a.get(e).onsuccess=e=>t(e.target.result)))}async dbPutItem(e,t,r){let a=this.I,s=await this.dbSelect(r);return a.Async((r=>s.put(e,t).onsuccess=e=>r(e.target.result)))}async dbPutArr(e,t){let r=this.I,a=await this.dbSelect(t);return r.Async(e.map((e=>r.Async((t=>a.put(e.data,e.name).onsuccess=e=>t(e.target.result))))))}async dbRemoveItem(e,t){let r=this.I,a=await this.dbSelect(t);return t.index&&(a=a.index(t.index)),r.array(e)?r.Async(e.map((e=>e&&r.Async((t=>a.delete(e).onsuccess=r=>t(e)))))):r.Async((t=>a.delete(e).onsuccess=r=>t(e)))}async dbGetAll(e){let t=this,r=t.I,a=t.T,s=await t.dbSelect(e,!0);return r.Async((n=>{e.index&&(s=s.index(e.index));let i={},l=s.openCursor(e.Range);a.on(l,"success",(s=>{let l=s.target.result;if(l){if(e.only&&a.part&&a.maxsize&&r.u8buf(l.value.contents)&&l.value.filesize>a.maxsize){let e=l.primaryKey.split(a.part),s=e[0],n=e[1]||0;if(i[s])i[s].contents.set(l.value.contents,n*a.maxsize);else{let e=r.U8(l.value.filesize);e.set(l.value.contents,n*a.maxsize),delete l.value.contents,i[s]=t.assign(l.value,{contents:e})}}else i[l.primaryKey]=l.value;l.continue()}else n(i)})),a.on(l,"error",(e=>n(i)))}))}async dbGetKeys(e){let t=this,r=t.I,a=await t.dbSelect(e,!0);return r.Async((s=>{e.index&&(a=a.index(e.index)),a.getAllKeys(e.Range).onsuccess=a=>{s(e.only?r.toArr(a.target.result).filter((e=>!e.includes(t.T.part))):a.target.result)}}))}async dbGetCursor(e){let t=this,r=t.I;r.str(e)&&(e={index:e});let a=e.index,s=t.T,n=await t.dbSelect(e,!0),i=n.indexNames.length;if(i&&!a)a=n.indexNames[0];else if(!i)return t.dbGetKeys(e);return r.Async((t=>{let i={};n.index(a).openKeyCursor(e.Range).onsuccess=n=>{let l=n.target.result;l?((!e.only||s.part&&!l.primaryKey.includes(s.part))&&(i[l.primaryKey]=r.FromEntries([[a,l.key]])),l.continue()):t(i)}}))}async dbClearTable(e,t){let r=this,a=r.I;return await a.Async((a.str(e)?[e]:e).map((async e=>(await r.dbSelect({store:e,dbName:t})).clear())))}async deleteDatabase(e,t){if(!e)return this.idb.deleteDatabase(t);await this.dbOpen(t,null,null,(t=>t.target.result.deleteObjectStore(e)))}get dbname(){return this.T.DB_NAME}constructor(e){e.Set(this),e.Libzip||(e.Libzip=this.zipsrc)}}(this);DataStore=(e=>class{get T(){return e}get I(){return e.I}constructor(t,r,a){let s=this;s.I.defines(s,{table:{value:t},name:{value:r||s.T.DB_NAME},getItem:{value:(...t)=>s.callFunc(e.getItem,t)},setItem:{value:(...t)=>s.callFunc(e.setItem,t)},removeItem:{value:(...t)=>s.callFunc(e.removeItem,t)},getAllData:{value:(...t)=>s.callFunc(e.getAllData,t)},getContent:{value:(...t)=>s.callFunc(e.getContent,t)},setContent:{value:(...t)=>s.callFunc(e.setContent,t)},getAllKeys:{value:(...t)=>s.callFunc(e.getAllKeys,t)},getAllCursor:{value:(...t)=>s.callFunc(e.getAllCursor,t)},clearTable:{value:(...t)=>s.callFunc(e.clearTable,t)},removeTable:{value:(...t)=>s.callFunc(e.removeTable,t)},transaction:{value:t=>e.F.dbSelect(s.setName(),t)}},!1),s.read=s.get,s.write=s.put,s.load=s.getData,s.save=s.setData,s.T.F.dbSetConf(t,r,!1,a||{})}setName(e){return this.I.assign({dbName:this.name,store:this.table},e)}get(e,t,r){return this.getItem(e,t,this.setName(r))}put(e,t){return this.setItem(e,t,this.name)}remove(e,t){let r=this.setName(t);return r.clear=!0,this.removeItem(e,r)}data(e,t,r){return this.getData(e,t,r)}getData(e,t,r){return this.getContent(e,t,this.setName(r))}setData(e,t,r){return this.setContent(e,t,this.setName(r))}keys(e){return this.getAllKeys(this.setName(e))}cursor(e,t,r){return this.getAllCursor(e,t,this.setName(r))}all(e,t){return this.getAllData(e,this.setName(t))}clear(){return this.clearTable(this.name)}delete(){return this.removeTable(this.name)}callFunc(e,t){return this.I.Apply(e,this.T,[this.table].concat(t))}})(this)};