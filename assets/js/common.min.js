const Nenge=new class{version=1;DB_NAME="Nenge";DB_STORE_MAP={libjs:{},myfile:{timestamp:!1}};LibStore="libjs";maxsize=104857600;part="-part-";lang={};action={};StoreTable={};isLocal=/^(127|localhost|172)/.test(location.host);constructor(){let e=this,t=e.I;window.matchMedia&&!window.matchMedia("(prefers-color-scheme: light)").matches&&t.setStyle(document.documentElement,{"color-scheme":"dark"}),e.language=t.language,e.i18nName=t.i18n,t.mobile&&e.on(window,"error",(e=>alert(e.message||e)));let a=document.currentScript&&document.currentScript.src.split("?");e.JSpath=a&&a[0].split("/").slice(0,-1).join("/")+"/",e.triger(document,"NengeStart",{detail:e}),e.RunJs(a[1])}async RunJs(e){let t=this,a=t.I;if(e){let r=a.FormGet(e);t.SP(r.get("js")||"",(e=>t.addJS(this.F.getpath(e+".js?"+(t.isLocal?t.time:""))))),t.version=r.get("version")||t.version}t.docload((e=>t.triger(document,"NengeReady",{detail:t})))}get date(){return new Date}get time(){return this.date.getTime()}get rand(){return Math.random()}get randNum(){return this.I.IntVal(this.rand.toString().slice(2))}dbName(e){return e||this.DB_NAME}async getItem(e,t,a,r){if((r=r||{}).dbName=this.dbName(r.dbName),r.store=e,!t)return await this.getAllData(e,1,r);let s=this,n=s.F,i=s.I,l=await n.dbGetItem(t,r);if(i.obj(l)){let e=s.maxsize,o=s.part,u=t.split(o)[0],c=l.version,d=l.filesize/e,p=l.type;a&&c&&c!=a?l=void 0:d>1&&(l.contents=i.R(14,(await n.dbGetItem(i.toArr(d).map((e=>{let a=u;if(e>0&&(a+=o+e),a!=t)return a})),r)).map((e=>e?e.contents:l.contents)),l.filename||u,{type:l.filetype||n.getMime(l.filename||u)}));let m=l.contents;!m||i.str(m)||i.obj(m)||("unpack"==p?m=await n.unFile(m,{password:r.password||l.password,process:r.process}):["String","Json"].includes(p)?(m=i.blob(m)?await m.text():i.decode(m),("Json"==p||/json/.test(l.filetype))&&(m=i.Json(m))):"File"!=p&&i.blob(m)&&(m=i.U8(await m.arrayBuffer())),l.contents=m)}return l}async setItem(e,t,a,r){let s=this,n=s.F,i=s.I,l=s.maxsize,o=s.part,u={store:e,dbName:s.dbName(r)};if(i.obj(a)&&a.contents){let e=a.contents;if(e=await n.dbU8(e,l),i.u8buf(e)&&e.byteLength>l){let r=e.byteLength;a.filesize=r,a.contents=null,delete a.contents,a=i.toObj(i.toArr(a).filter((e=>!i.none(e[1]))));let s=await n.dbPutArr(i.toArr(r/l).map((s=>{let n=s*l;return{data:i.assign({contents:i.U8(e.subarray(n,r-n>=l?n+l:r))},a),name:s>0?t+o+s:t}})),u);return e=null,s}a.contents=e}else if(a&&(a=await n.dbU8(a,l),i.u8buf(a)&&a.byteLength>l))return s.setItem(e,t,{contents:a,timestamp:s.date},r);return await n.dbPutItem(a,t,u)}async removeItem(e,t,a){let r=this,s=r.I,n=r.F;if((a=a||{}).dbName=r.dbName(a.dbName),a.store=e,a.filesize&&(a.clear=!0),a.clear){if(!a.filesize){let e=await n.dbGetItem(t,a);a.filesize=e&&e.filesize,r.null(e)}if(a.filesize){let e=t.split(r.part)[0];return await n.dbRemoveItem(s.toArr(a.filesize/r.maxsize).map((t=>{let a=e;return t>0&&(a+=r.part+t),a})),a)}}return await n.dbRemoveItem(t,a)}async getAllData(e,t,a){if(!e)return{};let r=this;return a=a||{},await r.F.dbGetAll(r.I.assign(a,{store:e,only:t,dbName:r.dbName(a.dbName)}))}async getContent(e,t,a,r){(r=r||{}).dbName=this.dbName(r.dbName);let s=await this.getItem(e,t,a,r);return s&&s.contents||s}async setContent(e,t,a,r){let s=this;return r=r||{},await s.setItem(e,t,s.I.assign({contents:a,timestamp:s.date},r.options),s.dbName(r.dbName))}async getAllKeys(e,t){let a=this;return t=t||{},await a.F.dbGetKeys(a.I.assign(t,{store:e,dbName:a.dbName(t.dbName)}))}async getAllCursor(e,t,a,r){let s=this;return r=r||{},await s.F.dbGetCursor(s.I.assign(r,{store:e,only:a,index:t,dbName:s.dbName(r.dbName)}))}async clearTable(e,t){if(!e)return;let a=this.F;return await a.dbClearTable(e,this.dbName(t))}async removeTable(e,t){let a=this.F;return await a.deleteDatabase(e,this.dbName(t))}getStore(e,t,a){if(!e)return;let r=this;return e instanceof r.DataStore?e:(t=r.dbName(t),r.StoreTable[t]||(r.StoreTable[t]={}),r.StoreTable[t][e]||(r.StoreTable[t][e]=new r.DataStore(e,t,a)),r.StoreTable[t][e])}async FetchItem(e){let t=this,a=t.F,r=t.I;e&&!r.str(e)||(e={url:e||"/"});let s,n,i,l="arrayBuffer",o=a.getname(e.url),u=e.key||o||"index.php",c=u==a.LibKey?u+o:u,d=e.version,p={},m=e.decode,h=m&&(r.str(m)?e=>r.decode(e,m):!0===m?r.decode:m),b=e.store&&t.getStore(e.store,e.dbName,e.index,e.dbOpt),g=(t,s)=>a.unFile(t,r.assign(e,{password:s})),y=async a=>(a&&a.contents&&("unpack"==a.type?(a=await g(a.contents,a.password)).password&&delete a.password:a=a.contents),f(a),t.null(e),e=null,a),f=t=>t&&e.success&&e.success(t,p);if(delete e.store,e.filename||(e.filename=o),e.onLine&&(e.unset=navigator.onLine),b&&(s=await b.get(c,d,e),s&&!e.unset&&!e.checksize))return y(s);if(n=await a.FetchStart(e).catch((t=>e.error&&e.error(t.message))),!n)return y(s);p=a.FetchHeader(n,e),r.exends(p,n,["url","status","statusText"]),e.filename&&(p.filename=e.filename);let w=p.password||e.password||void 0;if(200!=n.status)return n.body&&(n.body.cancel(),e.error&&e.error(n.statusText,p)),"head"==e.type&&f(p),y(s);if(s&&s.filesize&&p.byteLength>0){if(s.filesize==p.byteLength)return n.body.cancel(),y(s);t.null(s),s=null}else if("head"==e.type)return n.body.cancel(),y(p);let v=r.func(e.process)?await a.StreamResponse(n,e.process,p):n;e.unpack&&(e.type=l),e.type=e.type||l,i=await v[e.type]();let I=p.type,F=p.byteLength||0,A=p["content-type"];if(e.type==l&&r.buf(i)&&(i=r.U8(i),I=r.N(11)),e.Filter&&(i=await e.Filter(i)),F=i.byteLength||i.length,e.autounpack&&F<.3*t.maxsize&&(e.unpack=!0),e.dataOption=e.dataOption||{},b&&e.unpack&&u===c&&F>t.maxsize&&(I="unpack",await b.put(c,r.assign({contents:i,timestamp:new Date,filesize:F,filetype:A,version:d,type:I,password:w},e.dataOption)),b=null),e.unpack&&r.u8buf(i)&&(i=await g(i,w),i.byteLength||(i.password&&(w=i.password,delete i.password),I="datalist")),b&&u!==c){if(r.u8buf(i))i=a.getFileText(i,h,e.mime||p["content-type"]||a.getMime(""),o),I=r.blob(i)?"File":"String";else if(r.str(i))I=p["content-type"]||"String";else if("datalist"==I){let s;await r.Async(r.toArr(i).map((async n=>{let[i,l]=n,o=a.getname(i),c=a.getMime(o),d=a.getFileText(l,h,c,o);return await b.put(u+o,r.assign({contents:d,timestamp:t.date,filesize:l.byteLength,filetype:c,version:t.version,type:r.blob(d)?"File":"String"},e.dataOption)),e.filename==o&&(s=d),!0}))),s&&(i=s),s=null,b=null}}else h&&(i=a.getFileText(i,h,I),r.str(i)&&(I="String"));return b&&await b.put(c,r.assign({contents:i,timestamp:t.date,filesize:F,filetype:A,version:d,type:I,password:w},e.dataOption)),y(i)}ajax(e){let t=this,a=t.I;return a.str(e)&&(e={url:e}),a.Async((r=>{const s=new XMLHttpRequest(e.paramsDictionary);let n=["progress","readystatechange","error","abort","load","loadend","loadstart","timeout"];t.on(s,n[2],(t=>{e.error&&e.error("net::ERR_FAILED"),r(null)})),t.on(s,n[1],(t=>{let n;switch(s.readyState){case s.LOADING:case s.OPENED:case s.UNSENT:break;case s.HEADERS_RECEIVED:if(n=a.toObj((s.getAllResponseHeaders()||"").trim().split(/[\r\n]+/).map((e=>{let t=e.split(": ");return[t.shift(),t.join(": ")]})).concat([["status",s.status],["statusText",s.statusText],["url",e.url]])),"head"==e.type)return s.abort(),e.success&&e.success(n,s),void r(n);break;case s.DONE:200==s.status?(e.success&&e.success(s.response,n,s),r(s.response)):(e.error&&e.error(s.statusText,n,s),r(null));break}})),e.process&&t.on(s,n[0],(t=>e.process(a.PER(t.loaded,t.total),t.total,t.loaded,0,s))),e.postProcess&&t.on(s.upload,n[0],(t=>e.postProcess(a.PER(t.loaded,t.total),t.total,t.loaded,t))),a.toArr(n,(r=>a.none(e[r])||(t.on(s,val,e[r]),a.DP(e,r)))),e.upload&&a.toArr(n,(r=>a.none(e.upload[r])||(t.on(s,val,e.upload[r]),a.DP(e.upload,r))));let i,l=e.type||"",o=e.headers||{},u=e.noajax?{}:{inajax:t.time};e.overType&&s.overrideMimeType(e.overType),e.json?(i=a.toJson(e.json),l||(l="json"),a.assign(o,{Accept:"application/json, text/plain, */*"})):e.post&&(i=a.post(e.post)),"head"!=l&&(s.responseType=l),s.open(i?"POST":"GET",a.get(e.url,u,e.get)),a.toArr(o,(e=>s.setRequestHeader(e[0],e[1]))),s.send(i)}))}Set(e,t){const a=this;return t||(t=a.I),e.action||(e.action={}),t.defines(e,{I:t,T:a,RF:a.RF,CF:a.CF,BF:a.BF},1),t}RF(e,t){const a=this,r=a.action,s=a.I;if(r[e])return s.func(r[e])?s.Apply(r[e],a,t||[]):r[e]}CF(e,...t){return this.RF(e,t)}BF(e){const t=this,a=t.action,r=t.I;if(a[e])return r.func(a[e])?a[e].bind(t):a[e]}addJS(e,t,a,r){let s=this,n=s.F,i=s.I;if(i.blob(e)&&(r=n.getKeyName(e.name),/css/i.test(e.type)&&(a=!0)),r&&s.$("#link_"+r))return;let l=s.$ce(a?"link":"script"),o=t=>{e=n.URL(e,a?"css":"js"),a?(l.type=n.getMime("css"),l.href=e,l.rel="stylesheet"):(l.type=n.getMime("js"),l.src=e),r&&i.Attr(l,{id:"link_"+r}),l.onload=r=>{t&&t(r),a||(l.remove(),/^blob:/.test(e)&&n.removeURL(e)),e=null},s.$append(document[a?"head":"body"],l)};return t?(o(t),l):i.Async(o)}async loadScript(e,t,a){t=t||{};let r=this,s=r.F;t.url=s.getpath(e),a?t.type="text":(t.store||(t.store=r.LibStore),t.key||(t.key=s.LibKey)),t.version=t.version||r.version;let n=await r.FetchItem(t);return a?n:await r.addJS(n)}async getScript(e,t){return this.loadScript(e,t,!0)}async addScript(e,t){return await T.addJS(await T.getScript(e,t),null,"css"==F.getExt(e))}async loadLibjs(e,t,a,r,s){let n=this.F;return await this.addJS(await n.getLibjs(e,t,a,r,s),null,"css"==n.getExt(e))}unFile(e,t,a){return this.F.unFile(e,this.I.assign({process:t},a||{}))}on(e,t,a,r,s){let n=this,i=n.I;return e=n.$(e),n.SP(t,(t=>i.on(e,t,a,!1===r?{passive:!1}:r,s))),e}un(e,t,a,r,s){let n=this,i=n.I;return e=n.$(e),n.SP(t,(t=>i.un(e,t,a,!1===r?{passive:!1}:r,s))),e}spilt(e,t,a){let r=this.I,s=a||",";return r.toArr(r.str(e)?e.replace(/[\s\|,]+/g,s).split(s).filter((e=>!r.empty(e))):e,t)}SP(e,t,a){let r=this.I,s=a||",";return r.toArr(r.str(e)?e.replace(/[\s\|,]+/g,s).split(s).filter((e=>!r.empty(e))):e,t)}once(e,t,a,r){return this.on(e,t,a,{passive:!1,once:!0},r)}docload(e){let t=this,a=document;return"complete"==a.readyState?e&&e.call(t):t.I.Async((r=>{let s=()=>{e&&e.call(t),r(t)};"loading"==a.readyState?t.once(a,"DOMContentLoaded",s):s()}))}$(e,t){let a=this.I;return e?a.str(e)?a.$(e,t):a.func(e)?this.docload(e):e:void 0}$$(e,t){return this.I.$$(e,t)}$ce(e){return this.I.$c(e)}$ct(e,t,a,r){let s=this.I,n=this.$ce(e);return t&&(n.innerHTML=s.str(t)?t:t()),!r||s.Attr(n,r),!a||s.Attr(n,"class",a),n}$append(e,t){return this.I.str(t)&&(t=this.$ce(t)),e.appendChild(t),t}$add(e,t){return e.classList.add(t),e}customElement(e){let t=this;window.customElements.define(e,class extends HTMLElement{elmName=this.tagName.replace(/-/g,"_");constructor(){super(),t.CF("TAG_"+this.elmName+"_INIT",this,"init")}connectedCallback(){t.CF("TAG_"+this.elmName,this,"connect")}attributeChangedCallback(e,a,r){t.CF("TAG_"+this.elmName+"_ATTR",this,"attribute",{name:e,oldValue:a,newValue:r})}disconnectedCallback(){t.CF("TAG_"+this.elmName+"_REMOVE",this,"disconnect")}})}docElm(e,t){return(new DOMParser).parseFromString(e,t||"text/html")}HTMLToTxt(e,t){let a=this.I;return a.str(e)&&(e=this.docElm(e)),a.doc(e)?e.body[t?"innerHTML":"textContent"]:""}fragment(){return new DocumentFragment}Err(e){return new Error(e)}down(e,t,a){return this.F.download(e,t,a)}getLang(e,t){return this.GL(e,t)}GL(e,t){let a=this,r=a.I;return r.none(a.lang[e])||(e=a.lang[e]),r.obj(t)?r.RegRe(e,t):e}triger(e,t,a){let r=this,s=r.I;return e=r.$(e),a||(a={detail:e}),s.evt(t)?r.dispatch(e,t):r.dispatch(e,new s.O[22](t,a)),e}dispatch(e,t){return e.dispatchEvent(t),e}stopGesture(e){this.setStyle(e,{"touch-action":"none"})}stopEvent(e){e.preventDefault()}stopProp(e,t){t||e.preventDefault(),e.stopPropagation()}null(e){if(this.I.obj(e))for(var t in e)e[t]=null,delete e[t]}I=new class{O=[Array,Object,Element,HTMLFormElement,FormData,URLSearchParams,NamedNodeMap,DOMStringMap,CSSStyleDeclaration,Document,ArrayBuffer,Uint8Array,Promise,Blob,File,String,DOMRect,Event,KeyboardEvent,Function,Boolean,Headers,CustomEvent,HTMLCollection,FileList,TextDecoder,TextEncoder,NodeList,Number,RegExp];constructor(e){let t=this,r=t.O;t.defines(this,{IF:{value:(e,t)=>e instanceof r[t]},elm:{value:e=>t.IF(e,2)},elmform:{value:e=>t.IF(e,3)},urlpost:{value:e=>t.IF(e,4)},urlget:{value:e=>t.IF(e,5)},nodemap:{value:e=>t.IF(e,6)},DOMmap:{value:e=>t.IF(e,7)},elmCss:{value:e=>t.IF(e,8)},await:{value:e=>t.IF(e,12)},blob:{value:e=>t.IF(e,13)},file:{value:e=>t.IF(e,14)},evt:{value:e=>t.IF(e,17)},keyevt:{value:e=>t.IF(e,18)},func:{value:e=>t.IF(e,19)},header:{value:e=>t.IF(e,21)},nodelist:{value:e=>t.IF(e,27)},IC:{value:(e,a)=>t.C(e)===r[a]},array:{value:e=>t.IC(e,0)},obj:{value:e=>t.IC(e,1)},doc:{value:e=>t.IC(e,9)},buf:{value:e=>t.IC(e,10)},u8obj:{value:e=>t.IC(e,11)},u8buf:{value:e=>t.IC(e,11)},str:{value:e=>t.IC(e,15)},bool:{value:e=>t.IC(e,20)},num:{value:e=>t.IC(e,28)},null:{value:e=>null===e},none:{value:e=>void 0===e},R:{value:(e,...t)=>Reflect.construct(this.O[e],t)},H:{value:e=>a[0]&&e.hasOwnProperty(a[0])||!1},DP:{value:(e,...t)=>Reflect.deleteProperty(e,t[0])},Arr:{value:e=>new r[0](e)},ArrFrom:{value:e=>r[0].from(e)},FromEntries:{value:e=>r[1].fromEntries(e)},Keys:{value:e=>r[1].keys(e)},U8:{value:e=>t.u8buf(e)?e:new r[11](e.buffer||e)},buf16str:{value:e=>t.toArr(e).map((e=>e.toString(16).padStart(2,0).toLocaleUpperCase())).join("")},ArrTest:{value:(e,...a)=>t.toArr(e).filter((e=>e[1].test(a[0])))[0]},decode:{value:(e,...t)=>new r[25](t[0]).decode(e)},encode:{value:e=>(new r[26]).encode(e)},FormPost:{value:e=>new r[4](e)},FormGet:{value:e=>new r[5](e)},Int:{value:e=>new r[28](e)},IntVal:{value:(e,...t)=>parseInt(e,t[0])},IntSize:{value(e){e=this.Int(e)}},PER:{value:(e,...a)=>t.Int(100*e/a[0]).toFixed(0)+"%"},Async:{value(e,...t){return e?this.array(e)?Promise.all(e):new Promise(e,t[0]):null}},$:{value:(e,...t)=>(t[0]||document).querySelector(e)},$$:{value:(e,...t)=>(t[0]||document).querySelectorAll(e)},$c:{value:(e,...t)=>document.createElement(e)},RegRe:{value:(e,...a)=>(t.toArr(a[0],(t=>e=e.replace(new r[29]("{"+t[0]+"}","g"),t[1]))),e)},elmdata:{value:e=>t.toObj(e.dataset||e||{})||{}},setStyle:{value:(e,...a)=>(t.toArr(a[0],(a=>(e.style||e)[(t.bool(a[1])&&!a[1]?"remove":"set")+"Property"](a[0],a[1]))),e)},Attr:{value:(e,...a)=>t.obj(a[0])?t.toArr(a[0],(a=>t.Attr(e,a[0],a[1]))):a[0]?e[(a[1]?"set":"get")+"Attribute"](a[0],a[1]):t.toObj(e.attributes)},Call:{value:(e,...t)=>Reflect.apply(e,t.shift(),t)},Apply:{value:(e,...a)=>(t.str(e)&&(e=a[0][e]),Reflect.apply(e,a[0],a[1]))},on:{value(e,...a){e&&t.Apply(addEventListener,e,a)}},un:{value(e,...a){e&&t.Apply(removeEventListener,e,a)}},GP:{value:(e,t)=>e.getPropertyValue(t)},EQ:{value(e){let t=[],a=e.next();for(;!a.done;)t.push(a.value),a=e.next();return t}},ET:{value(e){let a=[];for(let r=0;r<e.length;r++){let s=e.item(r);"string"==typeof s?a.push([s,t.GP(e,s)]):s.value&&a.push([s.name,s.value])}return a}},FE:{value(e){let t=[];return e.forEach(((e,a)=>t.push([a,e]))),t}},getEntries:{value:e=>e.item?t.ET(e):e.entries?t.EQ(e.entries()):e.length?t.ArrFrom(e):e.forEach?t.FE(e):t.Entries(e)}})}N(e){return isNaN(e)?this.X(e):this.O[e].name}C(e){return null!=e&&null!=e&&e.constructor}X(e){return this.C(e)&&this.C(e).name||""}F(e,t){return t&&e.forEach&&e.forEach(t),e}assign(...e){let t=this;return t.Apply(t.O[1].assign,{},t.array(e[0])?e[0]:e)}exends(e,t,a){return a?this.toArr(a,(a=>e[a]=t[a])):e=this.assign(e,t),e}get mobile(){return"ontouchend"in document}get language(){return navigator.language}get i18n(){let e=this.language.split("-");return e="zh"==e[0]?"CN"==e[1]?"zh-hans":"zh-hant":e[0],e}post(e){let t=this,a=t.urlpost(e)?e:t.FormPost(t.elmform(e)?e:t.str(e)?t.$(e):void 0);return t.obj(e)&&t.toArr(e,(e=>a.append(e[0],e[1]))),a}get(e,...t){let a=this,r=e.split("?"),s=r[1]&&r[1].split("#")[0]||"",n=a.toArr(t).map((e=>e?a.FormGet(e):"")).join("&"),i=a.FormGet(s+"&"+n).toString().replace(/=&/g,"&");return r[0]+(i?"?"+i:"")}toObj(e){if(!e)return{};let t=this;return t.obj(e)?e:e=t.array(e)?t.FromEntries(e):t.FromEntries(t.getEntries(e))}Entries(e,t){return this.F(this.O[1].entries(e),t)}toArr(e,t){if(!e)return[];let a=[],r=this,s=r.C(e);return a=e.byteLength||e.length?r.ArrFrom(e):r.obj(e)?r.Entries(e):s==r.O[28]?Array.from("".padStart(e)):s!=r.O[0]?r.getEntries(e):e,r.func(t)?r.F(a,t):a}define(e,t,a,r,s){return this.O[1].defineProperty(e,t,r?{get:()=>a,configurable:!!s}:a),e}defines(e,t,a,r){return a?this.toArr(t,(t=>this.define(e,t[0],t[1],1,r))):this.O[1].defineProperties(e,t),e}Json(e){let t=this,a=t.O;return t.u8buf(e)&&(e=t.decode(e)),"string"==typeof e?new a[19]("return "+e)():e}toJson(e){return JSON.stringify(this.Json(e))}empty(e){return!e||(this.str(e)?0==e.trim().length:this.array(e)?0==e.length:!!this.obj(e)&&0==this.toArr(e).length)}}(this);F=new class{Libjs={};LibKey="script-";zipsrc="zip.min.js";extutf16={"7z":/^377ABCAF271C/,rar:/^52617221/,zip:/^504B0304/,png:/^89504E470D0A1A0A/,gif:/^47494638/,jpg:/^FFD8FF/,webp:/^52494646/,pdf:/^255044462D312E/};exttype={"application/octet-stream":["*"],"application/javascript":["js"],"text/css":["css","style"],"text/scss":["scss"],"text/sass":["sass"],"text/html":["html","htm","php"],"text/plain":["txt"],"text/xml":["xml","vml"],image:["jpg","jpeg","png","gif","webp"],font:["woff","woff2","ttf","otf"],"image/svg+xml":["svg"],application:["pdf","json"],"application/x-zip-compressed":["zip"],"application/x-rar-compressed":["rar"],"application/x-7z-compressed":["7z"]};action={textext(e){let t=this.I,a=t.buf16str(e),r=t.ArrTest(this.extutf16,a);return r&&r[0]?r[0]:""},async rar(e,t,a){let r,s=this,n=s.I;n.blob(e)&&(!t.filename&&e.name&&(t.filename=e.name),e=n.U8(await e.arrayBuffer())),a=a||"libunrar.min.zip";let i,l=await s.getLibjs(a,r);return t.process&&(i=t.filename?s.T.getLang("Decompress:")+t.filename+" --":s.T.getLang("Decompress:"),r=e=>t.process(i+(e.file?s.getname(e.file):"")+" "+n.PER(e.current,e.total),e.total,e.current)),n.Async((a=>{let n,i=new Worker(l);i.onmessage=l=>{let o=l.data,u=o.t;if(1===u)a(n||e),l.target.terminate();else if(2===u)n||(n={}),n[o.file]=o.data;else if(4===u&&o.total>0&&o.total>=o.current)r&&r(o);else if(-1==u){let r=prompt(s.T.getLang(o.message),t.password||"");if(!r)return a(e),l.target.terminate();t.unpack&&(n.password=r),t.password=r,i.postMessage({password:r})}},i.onerror=async t=>{a(e),i.terminate()},i.postMessage({contents:e,password:t.password})}))},"7z":function(e,t){return this.CF("rar",e,t,"extract7z.zip")},async zip(e,t={}){return this.T.Libzip==this.zipsrc?this.CF("zipjs",e,t):this.CF("rar",e,t,this.T.Libzip)},async zipjs(e,t){t=t||{};let a=this.T;window.zip||await a.loadLibjs(a.JSpath+this.zipsrc);var r=new zip.ZipReader(new(zip[a.I.u8buf(e)?"Uint8ArrayReader":"BlobReader"])(e)),s={},n=void 0,i=async e=>{s[e.filename]=await e.getData(new zip.Uint8ArrayWriter,{onprogress:(r,s)=>t.process&&t.process(e.filename+" "+a.I.PER(r,s)),password:n})},l=async e=>{try{null==n&&(n=t.password),await i(e)}catch(t){n=window.prompt(a.getLang("Invalid password"),n),await l(e)}},o=await r.getEntries(),u=0;if(o)for(;o[u];){let e=o[u];u++,e.directory||(e.encrypted&&!n?await l(e):await i(e))}return s}};async StreamResponse(e,t,a){let r=this.I,s=a["content-length"]||0,n=this.T.getLang("process:"),i=0,l={done:!1,value:!1},o=await e.body.getReader();return new Response(new ReadableStream({async start(e){for(;!l.done;){let u=0,c="";l.value&&(u=l.value.length,i+=u,e.enqueue(l.value)),c=s&&i<s?n+r.PER(i,s):n+(i/1024).toFixed(1)+"KB",t((a.filename?a.filename+" ":"")+c,s,i,u),l=await o.read()}e.close()}}))}FetchHeader(e,t){let a=this.I,r=a.toObj(e.headers)||{};return a.F((r["content-type"]||this.getMime(t.url||"html")).split(";"),((e,t)=>{if(e=e.trim().toLowerCase(),0==t)r["content-type"]=e.trim();else if(-1!=e.search(/=/)){let t=e.split("=");r[t[0].trim()]=t[1].trim()}})),a.assign(r,{byteLength:a.IntVal(r["content-length"])||0,password:r.password||r["content-password"],type:r.type||r["content-type"].split("/")[1].split("+")[0]})}async FetchStart(e){let t,a=this.I,r={headers:{}};return a.toArr(["headers","context","referrer","referrerPolicy","mode","credentials","redirect","integrity","cache"],(t=>a.none(e[t])||(r[t]=e[t],a.DP(e,t)))),e.json?(t=a.toJson(e.json),r.headers.Accept="application/json"):e.post&&(t=a.post(e.post)),t&&(r.method="POST",r.body=t),a.toArr(["get","post","json"],(t=>a.DP(e,t))),fetch(a.get(e.url,e.get),r)}CheckExt(e){let t=this.I,a=e.slice(0,16),r=this.BF("textext"),s=t.blob(a)?a.arrayBuffer():t.str(a)?t.encode(a):a;return t.await(s)?t.Async((async e=>e(r(await s)))):r(s)}async unFile(e,t={}){let a=this,r=a.I;r.await(e)&&(e=await e),r.array(e)&&(e=r.U8(e));let s=await a.CheckExt(e);return!a.action[s]||t.PassExt&&t.PassExt.includes(zip)?(r.blob(e)&&(e=r.U8(await e.arrayBuffer())),e):await a.CF(s,e,t)}async getLibjs(e,t,a,r,s){let n=this,i=n.T,l=n.I,o=n.getname(e),u=o.replace(/\.zip$/,".js");if(n.Libjs[o])return n.Libjs[o];if(n.Libjs[u])return n.Libjs[u];a=a||i.version;let c=await i.getStore(i.LibStore).data(n.LibKey+u,a);return c||(/\.zip$/.test(o)&&await n.getLibjs(i.Libzip,t),c=await i.FetchItem({url:n.getpath(e),store:i.LibStore,key:n.LibKey,unpack:!0,filename:u,version:a,process:t,Filter:s,decode:r})),/json$/.test(u)?n.Libjs[u]=c:c&&(l.obj(c)?n.I.toArr(c,(e=>n.Libjs[e[0]]=e[1]&&n.URL(e[1],e[0]))):n.Libjs[u]=n.URL(c,u)),c=null,n.Libjs[u]}getname(e){return(e||"").split("/").pop().split("?")[0].split("#")[0]}getpath(e){return/^(\/|https?:\/\/|static\/js\/|data\/|assets|blob\:|\.|\/)/.test(e)?e:this.T.JSpath+e}getFileText(e,t,a,r){let s=this,n=s.I;return/json$/.test(a)&&n.u8buf(e)?n.Json(e):r&&a&&!t?n.R(14,[e],r,{type:a}):t?n.u8buf(e)?t(e):(n.obj(e)&&n.toArr(e,(a=>{/(text|javascript|xml|json)/.test(s.getMime(a[0]))&&n.u8buf(a[1])&&("json"==s.getExt(a[0])?e[a[0]]=n.Json(a[1]):e[a[0]]=t(a[1]))})),e):e}getExt(e){return this.getname(e).split(".").pop().toLowerCase()}getKeyName(e){let t=this.getname(e).split(".");return t.pop(),t.join(".")}getMime(e,t){let a,r=this,s=r.I;return r.exttype[e]?a=e:(r.extlist||(r.extlist=s.assign(s.toArr(r.exttype).map((e=>s.toObj(s.toArr(e[1]).map((t=>{let a=e[0];return/\//.test(a)?/text\/xml/.test(a)&&"xml"!=t&&(a+="+"+t):(delete r.exttype[a],a+="/"+t),a!=e[0]&&(r.exttype[a]=[t]),[t,a]}))))))),a=r.extlist[r.getExt(e)]||r.extlist["*"]),t&&/(text|javascript|xml|json)/.test(a)?a+";chartset=utf8":a}URL(e,t){let a=this.I;return a.str(e)&&/^(blob|http|\/|\w+\/|\.+\/)[^\n]*$/i.test(e)?e:window.URL.createObjectURL(a.blob(e)?e:new Blob([e],{type:this.getMime(t||"js")}))}removeURL(e){return window.URL.revokeObjectURL(e)}download(e,t,a){let r,s=this;s.I.str(e)?/^(http|blob:)/.test(e)?(r=e,e="n.js"):t&&(r=s.URL(t,a)):(r=s.URL(e,a),e=e.name||"n.js");let n=document.createElement("a");n.href=r,n.download=e,n.click(),n.remove()}get idb(){return window.indexedDB||window.webkitindexedDB}dbConf={};DataBase={};dbSetConf(e,t,a,r){let s=this,n=s.I,i=s.T,l=s.dbConf,o=s.dbname;return l[s.dbname]||(l=n.assign(l,n.toObj([[o,i.DB_STORE_MAP]]))),e&&(l[t]||(l[t]={}),l[t][e]||(l[t][e]=r||a&&n.toObj([[a,!1]])||{})),l!=s.dbConf&&(s.dbConf=l),l}async dbLoad(e,t,a){let r=this,s=r.I,n=r.dbSetConf(e,t,a)[t],i=r.DataBase[t];if(i&&(s.await(i)&&(i=await i),i.objectStoreNames.contains(e)))return i;if(i||(r.DataBase[t]=r.dbOpen(t,n,undefined),i=await r.DataBase[t]),!r.dbCheckTable(i,n).length)return i;throw"indexDB error"}async dbOpen(e,t,a,r){let s=this,n=s.T,i=n.I;if(s.dbVer||(s.dbVer=i.toObj((await s.idb.databases()).map((e=>[e.name,e.version])))),r&&!t){if(!s.dbVer[e])return;a||(s.DataBase[e]&&(await s.DataBase[e]).close(),delete s.DataBase[e],a=s.dbVer[e]+1)}return i.Async(((l,o)=>{let u=s.idb.open(e,a);n.once(u,"error",(async e=>{o(e)})),n.once(u,"upgradeneeded",r||(async e=>{let a=e.target.result;s.dbCheckTable(a,t,(e=>{let t=a.createObjectStore(e[0]);i.toArr(e[1],(e=>t.createIndex(e[0],e[1]&&e[1].key||e[0],e[1]&&e[1].options||e[1]||{unique:!1})))}))})),n.once(u,"success",(async a=>{let n=a.target.result;if(s.dbVer[e]=n.version,i.toArr(n.objectStoreNames,(t=>s.dbConf[e][t]=s.dbConf[e][t]||{})),r)return l(!0);s.dbCheckTable(n,t).length?(n.close(),s.dbOpen(e,t,n.version+1).then((e=>l(e)))):l(n)}))}))}dbCheckTable(e,t,a){return e?this.I.toArr(t).filter((t=>{if(!e.objectStoreNames.contains(t[0]))return a&&a(t)||!0})):[]}async dbU8(e,t){let a=this.I;return a.await(e)&&(e=await e),a.str(e)&&4*e.lenth>t?e=a.encode(e):a.blob(e)&&e.size>t?e=a.U8(await e.arrayBuffer()):e.buffer&&(e=a.U8(e)),e}async dbSelect(e,t){let a=this,r=a.T;a.I.str(e)&&(e={store:e}),e.store instanceof r.DataStore&&(e.store=e.store.table);let s=e.store;t=t?"readonly":"readwrite";let n=(await a.dbLoad(s,e.dbName,e.index)).transaction([s],t);return n.onerror=e=>{throw e.preventDefault(),n.error},n.objectStore(s)}async dbGetItem(e,t){let a=this.I,r=await this.dbSelect(t,!0);return a.array(e)?a.Async(e.map((e=>e&&a.Async((t=>r.get(e).onsuccess=e=>t(e.target.result)))))):a.Async((t=>r.get(e).onsuccess=e=>t(e.target.result)))}async dbPutItem(e,t,a){let r=this.I,s=await this.dbSelect(a);return r.Async((a=>s.put(e,t).onsuccess=e=>a(e.target.result)))}async dbPutArr(e,t){let a=this.I,r=await this.dbSelect(t);return a.Async(e.map((e=>a.Async((t=>r.put(e.data,e.name).onsuccess=e=>t(e.target.result))))))}async dbRemoveItem(e,t){let a=this.I,r=await this.dbSelect(t);return t.index&&(r=r.index(t.index)),a.array(e)?a.Async(e.map((e=>e&&a.Async((t=>r.delete(e).onsuccess=a=>t(e)))))):a.Async((t=>r.delete(e).onsuccess=a=>t(e)))}async dbGetAll(e){let t=this,a=t.I,r=t.T,s=await t.dbSelect(e,!0);return a.Async((n=>{e.index&&(s=s.index(e.index));let i={},l=s.openCursor(e.Range);r.on(l,"success",(s=>{let l=s.target.result;if(l){if(e.only&&r.part&&r.maxsize&&a.u8buf(l.value.contents)&&l.value.filesize>r.maxsize){let e=l.primaryKey.split(r.part),s=e[0],n=e[1]||0;if(i[s])i[s].contents.set(l.value.contents,n*r.maxsize);else{let e=a.U8(l.value.filesize);e.set(l.value.contents,n*r.maxsize),delete l.value.contents,i[s]=t.assign(l.value,{contents:e})}}else i[l.primaryKey]=l.value;l.continue()}else n(i)})),r.on(l,"error",(e=>n(i)))}))}async dbGetKeys(e){let t=this,a=t.I,r=await t.dbSelect(e,!0);return a.Async((s=>{e.index&&(r=r.index(e.index)),r.getAllKeys(e.Range).onsuccess=r=>{s(e.only?a.toArr(r.target.result).filter((e=>!e.includes(t.T.part))):r.target.result)}}))}async dbGetCursor(e){let t=this,a=t.I;a.str(e)&&(e={index:e});let r=e.index,s=t.T,n=await t.dbSelect(e,!0),i=n.indexNames.length;if(i&&!r)r=n.indexNames[0];else if(!i)return t.dbGetKeys(e);return a.Async((t=>{let i={};n.index(r).openKeyCursor(e.Range).onsuccess=n=>{let l=n.target.result;l?((!e.only||s.part&&!l.primaryKey.includes(s.part))&&(i[l.primaryKey]=a.FromEntries([[r,l.key]])),l.continue()):t(i)}}))}async dbClearTable(e,t){let a=this,r=a.I;return await r.Async((r.str(e)?[e]:e).map((async e=>(await a.dbSelect({store:e,dbName:t})).clear())))}async deleteDatabase(e,t){if(!e)return this.idb.deleteDatabase(t);await this.dbOpen(t,null,null,(t=>t.target.result.deleteObjectStore(e)))}get dbname(){return this.T.DB_NAME}constructor(e){e.Set(this),e.Libzip||(e.Libzip=this.zipsrc)}}(this);DataStore=(e=>class{get T(){return e}get I(){return e.I}constructor(t,a,r){let s=this;s.I.defines(s,{table:{value:t},name:{value:a||s.T.DB_NAME},getItem:{value:(...t)=>s.callFunc(e.getItem,t)},setItem:{value:(...t)=>s.callFunc(e.setItem,t)},removeItem:{value:(...t)=>s.callFunc(e.removeItem,t)},getAllData:{value:(...t)=>s.callFunc(e.getAllData,t)},getContent:{value:(...t)=>s.callFunc(e.getContent,t)},setContent:{value:(...t)=>s.callFunc(e.setContent,t)},getAllKeys:{value:(...t)=>s.callFunc(e.getAllKeys,t)},getAllCursor:{value:(...t)=>s.callFunc(e.getAllCursor,t)},clearTable:{value:(...t)=>s.callFunc(e.clearTable,t)},removeTable:{value:(...t)=>s.callFunc(e.removeTable,t)}},!1),s.read=s.get,s.write=s.put,s.load=s.getData,s.save=s.setData,s.T.F.dbSetConf(t,a,!1,r||{})}setName(e){return this.I.assign({dbName:this.name},e)}get(e,t,a){return this.getItem(e,t,this.setName(a))}put(e,t){return this.setItem(e,t,this.name)}remove(e,t){let a=this.setName(t);return a.clear=!0,this.removeItem(e,a)}data(e,t,a){return this.getData(e,t,a)}getData(e,t,a){return this.getContent(e,t,this.setName(a))}setData(e,t,a){return this.setContent(e,t,this.setName(a))}keys(e){return this.getAllKeys(this.setName(e))}cursor(e,t,a){return this.getAllCursor(e,t,this.setName(a))}all(e,t){return this.getAllData(e,this.setName(t))}clear(){return this.clearTable(this.name)}delete(){return this.removeTable(this.name)}callFunc(e,t){return this.I.Apply(e,this.T,[this.table].concat(t))}})(this)};